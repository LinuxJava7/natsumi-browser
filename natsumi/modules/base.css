/*

Natsumi Browser - A userchrome for Firefox and more that makes things flow.

Copyright (c) 2024-present Green (@greeeen-dev)

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

*/

/* ==== Base theme ==== */

#nav-bar {
  border: none !important;
}

:root:not([inDOMFullscreen="true"]):not([drawtitle]) {
  #browser:not([data-is-child="true"]) #tabbrowser-tabbox {
    margin-right: var(--natsumi-browser-separation) !important;
    padding-bottom: var(--natsumi-browser-separation) !important;
    box-shadow: none !important;
    outline: none !important;

    .browserSidebarContainer {
      border: var(--natsumi-border-width) solid light-dark(rgba(0, 0, 0, 0.1), rgba(255, 255, 255, 0.1)) !important;
      border-radius: var(--natsumi-browser-border-radius) !important;
      overflow: hidden !important;

      &:has(.devtools-toolbox-side-iframe) {
        .browserContainer browser {
          border-radius: var(--natsumi-browser-border-radius) 0 0 var(--natsumi-browser-border-radius) !important;
        }

        .devtools-toolbox-side-iframe {
          border-radius: 0 var(--natsumi-browser-border-radius) var(--natsumi-browser-border-radius) 0 !important;
        }
      }
    }

    #statuspanel {
      max-width: calc(100% - 10px) !important;
      margin: 10px !important;

      #statuspanel-label {
        padding: 5px 8px !important;
        border: 1px solid light-dark(rgba(0, 0, 0, 0.1), rgba(255, 255, 255, 0.1)) !important;
        border-radius: 13px !important;
      }
    }
  }

  &:has(#sidebar-main[hidden]) {
    #browser:not([data-is-child="true"]) #tabbrowser-tabbox {
      padding-left: var(--natsumi-browser-separation) !important;
    }
  }
}

#sidebar {
  box-shadow: none !important;
}

#sidebar-box {
  padding: 0 !important;
  margin-right: var(--natsumi-browser-separation) !important;
  margin-bottom: var(--natsumi-browser-separation) !important;
  border: 1px solid light-dark(rgba(0, 0, 0, 0.1), rgba(255, 255, 255, 0.1)) !important;
  border-radius: var(--natsumi-browser-border-radius) !important;
}

#vertical-spacer {
  display: none !important;
}

#vertical-tabs {
  -moz-window-dragging: drag;
}

#nav-bar-customization-target, #PanelUI-button, #nora-statusbar {
  toolbarbutton {
    --toolbarbutton-outer-padding: 4px;
    max-height: 40px !important;

    .toolbarbutton-icon {
      box-sizing: content-box !important;
      width: 16px !important;
      height: 16px !important;
      padding: 6px !important;
      transition: background-color 0.2s ease, box-shadow 0.2s ease;
      border-radius: 4px !important;
    }

    .toolbarbutton-badge {
      position: absolute !important;
      right: 6px !important;
      top: 6px !important;
    }

    &:hover .toolbarbutton-icon {
      background-color: var(--natsumi-button-hover-color) !important;
    }

    &:active, &[open], &[checked] {
      .toolbarbutton-icon {
        background-color: var(--natsumi-button-active-color) !important;
        box-shadow: 0 0 4px rgba(0, 0, 0, 0.3);
      }
    }
  }

  #fxa-toolbar-menu-button {
    .toolbarbutton-icon {
      display: none !important;
    }

    hbox {
      box-sizing: content-box !important;
      width: 16px !important;
      height: 16px !important;
      padding: 6px !important;
      transition: background-color 0.2s ease, box-shadow 0.2s ease;
      border-radius: 4px !important;
    }

    .avatar-container {
      margin: 0 !important;
    }

    &:hover hbox {
      background-color: var(--natsumi-button-hover-color) !important;
    }

    &:active, &[open], &[checked] {
      hbox {
        background-color: var(--natsumi-button-active-color) !important;
        box-shadow: 0 0 4px rgba(0, 0, 0, 0.3) !important;
      }
    }
  }

  #downloads-button {
    min-width: 36px !important;

    .toolbarbutton-badge-stack {
      padding: 6px !important;
      transition: background-color 0.2s ease, box-shadow 0.2s ease;
    }

    &:hover .toolbarbutton-badge-stack {
      background-color: var(--natsumi-button-hover-color) !important;
    }

    &:active .toolbarbutton-badge-stack, &[open] .toolbarbutton-badge-stack {
      background-color: var(--natsumi-button-active-color) !important;
      box-shadow: 0 0 4px rgba(0, 0, 0, 0.3) !important;
    }
  }

  .unified-extensions-item-action-button {
    overflow: visible !important;
  }

  /*#workspaces-toolbar-button {
    &::before {
      content: "";
      width: 100%;
      height: 100%;
      background-color: red !important;
    }

    &:hover {
      background-color: transparent !important;
    }

    &:hover .toolbarbutton-icon {
      background-color: transparent !important;
    }

    &:active, &[open], &[checked] {
      .toolbarbutton-icon {
        background-color: transparent !important;
        box-shadow: none !important;
      }
    }
  }*/

  .toolbarbutton-badge-stack {
    padding: 0 !important;
    background-color: transparent !important;
  }

  .avatar-container {
    margin-left: 6px !important;
  }
}

/* Compact alerts */

/*noinspection CssInvalidFunction*/
#fullscreen-warning, #pointerlock-warning {
  border-radius: 50px !important;
  padding: 8px 10px !important;
  background-color: var(--natsumi-mat-hz-background) !important;
  border: 1px solid light-dark(rgba(20, 20, 20, 0.2), rgba(235, 235, 235, 0.3)) !important;
  box-shadow: 0 0 var(--natsumi-mat-hz-shadow-size) var(--natsumi-mat-hz-shadow-color) !important;
  transition: opacity 0.2s ease, top 0.2s ease !important;
  backdrop-filter: saturate(var(--natsumi-mat-hz-saturation)) contrast(var(--natsumi-mat-hz-contrast)) blur(var(--natsumi-mat-hz-blur-radius)) !important;
  opacity: 0;
  margin: 0 !important;
  left: 50% !important;
  translate: -50% 0 !important;

  &:not([hidden]) {
    display: flex !important;
  }

  &:not([onscreen]), &:is([hidden]) {
    top: 20px !important;
    opacity: 0;
  }

  /*noinspection CssInvalidFunction*/
  .pointerlockfswarning-domain-text, .pointerlockfswarning-generic-text {
    color: light-dark(black, white);
    font-size: 14px !important;
    margin-left: 10px !important;
    margin-right: 0 !important;
    padding-right: 5px !important;
  }

  &[onscreen] {
    top: 30px !important;
    opacity: 1;
  }
}

/* Fullscreen alert */

#fullscreen-warning {
  --natsumi-fullscreen-button: url('chrome://global/skin/media/picture-in-picture-enter-fullscreen-button.svg');
  --natsumi-fullscreen-exit-button: url('chrome://global/skin/media/picture-in-picture-exit-fullscreen-button.svg');

  &::before {
    display: none !important;
  }

  #fullscreen-exit-button {
    order: -1;
    border: none !important;
    background: transparent !important;
    appearance: none !important;
    border-radius: 6px !important;
    color: transparent !important;
    width: 24px !important;
    height: 24px !important;
    font-size: 0 !important;
    padding: 0 !important;
    margin: 0 !important;
    transition: background 0.3s ease !important;
    position: relative !important;

    /*noinspection CssInvalidFunction*/
    &::before {
      content: "";
      width: 16px;
      height: 16px;
      position: absolute;
      background-color: light-dark(black, white);
      left: 50%;
      top: 50%;
      background-repeat: no-repeat;
      background-position: center;
      transform: translate(-50%, -50%);
      mask-image: var(--natsumi-fullscreen-button);
      mask-size: 28px;
      mask-position: center;
    }

    &:hover {
      background: var(--natsumi-button-hover-color) !important;
    }

    &:active {
      background: var(--natsumi-button-active-color) !important;
    }

    &:hover, &:active {
      &::before {
        mask-image: var(--natsumi-fullscreen-exit-button);
      }
    }
  }

  /*noinspection CssInvalidFunction*/
  .pointerlockfswarning-domain-text, .pointerlockfswarning-generic-text {
    color: light-dark(black, white);
    font-size: 14px !important;
    margin-left: 10px !important;
    margin-right: 0 !important;
  }
}

/* Pointer lock alert */

#pointerlock-warning {
  &::before {
    content: "";
    width: 0 !important;
    height: 16px;
    background-size: 16px;
    background-position: center;
    background-repeat: no-repeat;
    background-image: url('../icons/lucide/lock.svg') !important;
  }

  .pointerlockfswarning-domain-text, .pointerlockfswarning-generic-text {
    margin-left: 2px !important;
  }
}

#notification-popup .popup-notification-secondary-button {
  display: flex !important;
}

.tools-and-extensions {
  justify-content: space-between !important;
  padding-bottom: var(--natsumi-browser-separation) !important;

  &[orientation="horizontal"] {
    width: calc(100% - calc(var(--natsumi-browser-separation) * 2)) !important;
    padding-inline: var(--natsumi-browser-separation) !important;
  }
}

@media -moz-pref("natsumi.sidebar.hide-sidebar-controls") {
  #vertical-tabs {
    min-height: 100% !important;
  }

  #tabbrowser-tabs::after {
    border-color: transparent !important;
  }
}

/* Single toolbar view */
@media -moz-pref("natsumi.theme.single-toolbar") and -moz-pref("sidebar.verticalTabs") {
  :root:not([customizing]):has(#sidebar-main[sidebar-launcher-expanded]) {
    #navigator-toolbox {
      width: var(--natsumi-sidebar-width) !important;
      min-height: 85px !important;
      z-index: 1 !important;
    }

    @media not (-moz-platform: macos) {
      .titlebar-buttonbox-container {
        margin-left: 0 !important;
        min-height: 40px !important;
        position: absolute;
        left: 100vw;
        transform: translateX(-100%);
        z-index: 999 !important;
      }
    }

    #nav-bar-customization-target {
      min-height: 40px;
      order: 1 !important;

      & > toolbarbutton, & > toolbaritem, & > toolbarspring {
        display: none !important;
      }

      #back-button, #forward-button, #stop-reload-button, #urlbar-container {
        display: flex !important;
      }

      @media -moz-pref("natsumi.theme.single-toolbar-show-menu-button") {
        max-width: fit-content !important;
        margin-left: auto !important;
      }

      @media not -moz-pref("natsumi.theme.single-toolbar-show-menu-button") {
        #unified-extensions-button  {
          display: flex !important;
          order: -1 !important;
          margin-right: auto !important;
        }
      }
    }

    #urlbar-container {
      --urlbar-margin-inline: var(--space-medium) !important;
      position: absolute !important;
      width: calc(var(--natsumi-sidebar-width) - calc(var(--space-medium) * 2)) !important;
      left: 0 !important;
      top: 40px !important;
    }

    #vertical-tabs {
      padding-top: 82px !important;
    }

    #unified-extensions-button {
      padding-left: var(--space-medium) !important;
    }

    #PanelUI-button {
      padding-left: calc(var(--space-medium) - 4px) !important;
    }

    #stop-reload-button {
      padding-right: var(--space-small) !important;
    }

    #PersonalToolbar {
      visibility: visible !important;
      width: calc(100vw - var(--natsumi-sidebar-width)) !important;
      margin-left: var(--natsumi-sidebar-width) !important;
      padding-left: 0 !important;
      padding-top: 6px !important;
      margin-top: -41px !important;
      overflow: visible !important;

      #personal-bookmarks {
        transition: visibility 0.2s ease !important;
      }

      @media not (-moz-platform: macos) {
        width: calc(100vw - var(--natsumi-sidebar-width) - var(--natsumi-window-buttons-width)) !important;
      }

      &[collapsed=true] {
        #personal-bookmarks {
          visibility: collapse !important;
        }
      }

      @media (not (-moz-platform: macos)) or (-moz-pref("natsumi.theme.show-bookmarks-on-hover")) {
        &:hover[collapsed=true] {
          min-height: 28px !important;
          max-height: 28px !important;

          #personal-bookmarks {
            visibility: visible !important;
            min-height: 28px !important;
          }
        }
      }
    }

    #browser {
      position: absolute !important;
      width: 100vw !important;
      height: 100vh !important;
    }

    #tabbrowser-tabbox {
      margin-top: var(--natsumi-browser-separation) !important;
      transition: margin-top 0.2s ease !important;
    }

    &:has(#PersonalToolbar[collapsed="false"]) #tabbrowser-tabbox {
      margin-top: calc(var(--natsumi-browser-separation) + 30px) !important;
    }

    @media (not (-moz-platform: macos)) or (-moz-pref("natsumi.theme.show-bookmarks-on-hover")) {
      &:has(#PersonalToolbar:hover) #tabbrowser-tabbox {
        margin-top: calc(var(--natsumi-browser-separation) + 30px) !important;
      }
    }

    &[inDOMFullscreen="true"] #tabbrowser-tabbox, &[inDOMFullscreen="true"]:has(#PersonalToolbar[collapsed="false"]) #tabbrowser-tabbox {
      transition: none !important;
      margin-top: 0 !important;
    }

    @media not -moz-pref("natsumi.theme.single-toolbar-show-menu-button") {
      #PanelUI-button {
        display: none !important;
      }
    }
  }
}